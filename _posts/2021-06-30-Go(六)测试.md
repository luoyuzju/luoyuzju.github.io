layout: post
title: Go知识点大梳理(六)测试
category: Go语言
keywords: Go、测试
tags: Go、Go测试

# Go知识点大梳理（六）测试

## 0x00前言

在日常编程代码中，免不了需要自测代码的健壮性及性能。Go提供了测试专用工具go test，对包目录中以_test.go的文件进行测试，这些文件不会被go build命令编译的目标，而是go test的目标。

* 类别  

在*_test.go文件中，有三种形式的函数需要被特殊对待，分别是功能测试函数、基准测试函数和示例函数。go test工具扫描*_test.go文件寻找特殊函数，并生成一个临时的main包来调用测试函数，然后编译运行，汇报结果并清空临时文件。

## 0x01功能测试 
* 规范

&#160;&#160;&#160;&#160;&#160;&#160;&#160;每一个测试文件必须导入"testing"包，其次功能测试函数必须以Test开头，可选的后缀名称必须以大写字母开头，参数为(t *testing.T),参数t提供了汇报测试失败和日志记录的功能。  
&#160;&#160;&#160;&#160;&#160;&#160;&#160;被测文件需要和原文放置在同一文件夹，xxx_test.go可以调用xxx.go文件的函数。  
&#160;&#160;&#160;&#160;&#160;&#160;&#160;检测的原理是看检测函数内是否有error、fail等信号。总的输出包括T.Error-报告错误不影响运行,T.Fatalf-格式化输出错误并停止函数运行,T.Logf-输出日志。
```go
import "testing"

func TestName(t *testing.T) {
    //
}
```
```shell
go test //若失败输出日志，成功无日志
go test -v //输出所有的日志
go test -v -run="a|b" //测试匹配a|b的函数
go test -v xxx1_test.go xxx2_test.go //指定运行某文件内的测试函数
go test -v -test.run TestName //在当前文件夹下测试指定的方法
```
&#160;&#160;&#160;&#160;&#160;&#160;&#160;多组测试数据使用表单测试，将数据源存在一个数组内，遍历测试。
* 随机测试

&#160;&#160;&#160;&#160;&#160;&#160;&#160;测试者自己做一个保证输入正确的例子，观察输出是否为true。

* 白盒测试
* 覆盖率
```go
go test -coverprofile=c.out //产生覆盖率的日志文件
go tool cover -html=c.out //将日志文件转为html可视化
```

## 0x02基准测试 
* 规范  
目的：测试解决同一问题的不同方案的性能比较  


&#160;&#160;&#160;&#160;&#160;&#160;&#160;每一个测试文件必须导入"testing"包，其次基准测试函数必须以Test开头，可选的后缀名称必须以大写字母开头，参数为(b *testing.B),参数b不仅包含了T的功能，额外提供了一些性能测试相关方法，提供了一个整型成员N，用来指定被检测操作的次数。  
&#160;&#160;&#160;&#160;&#160;&#160;&#160;被测文件需要和原文放置在同一文件夹，xxx_test.go可以调用xxx.go文件的函数。  
。底层原理:基准测试框架默认在一段时间内反复调用需要测试的函数，每次调用函数时都会增加b.N的值，初始值为1。
```go
import "testing"
func BenchmarkXxxx(b *testing.B) {
    for i := 0; i < b.N; i++{
        Xxxx() //被测函数
    }
}
//带有初始条件和计时器重置版本
func BenchmarkMethod(b *testing.B) {
     //被测函数运行条件
     b.ResetTimer()//计时器归位
     for i:=0;i<b.N;i++{
         //被测函数
     }
}
```
```shell
go test -bench=. //匹配所有的基准测试函数
go test -bench=Xxxx//匹配Xxxx基准测试函数
-run//排除所有的单元测试，保证结果公正
-bench//表示基准测试的函数名
-benchtime//基准测试的最小执行时间为1秒，该参数用于指定运行时间长度
-benchmem//展示内存消耗
```
## 0x03示例函数 
